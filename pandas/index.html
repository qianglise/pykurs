<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pandas &mdash; LESSON NAME  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script src="../_static/tabs.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="SciPy" href="../scipy/" />
    <link rel="prev" title="NumPy" href="../numpy/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../" class="icon icon-home"> LESSON NAME
            <img src="../_static/ENCCS.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy/">NumPy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro">Intro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tidy-data-format">tidy data format</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-pre-processing">data pre-processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-cleaning">data cleaning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-reshaping">data Reshaping</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pivoting">pivoting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stacking-and-unstacking">stacking and unstacking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#groupby">groupby</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-aggregation">data aggregation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-transfromation">data transfromation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../scipy/">SciPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profile/">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scale/">Scaling to large datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpuintro/">Introduction to GPU architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miniapp/">Heat diffusion mini-app</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dask/">Dask for scalable analytics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">LESSON NAME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home"></a> &raquo;</li>
      <li>Pandas</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ENCCS/content/blob/main/content/pandas.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pandas">
<h1>Pandas<a class="headerlink" href="#pandas" title="Permalink to this headline"></a></h1>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>1</p></li>
<li><p>2</p></li>
</ul>
</div>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>1</p></li>
<li><p>2</p></li>
<li><p>3</p></li>
</ul>
</div>
<section id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline"></a></h2>
<p>Pandas is a Python package that provides high-performance and easy to use
data structures and data analysis tools. Build on numpy array, pandas is
particularly well suited to analyze tabular and time series data.
Although numpy could deal with structured array (array with mixed data types), it is not efficient.</p>
<p>The core data structures of pandas are series and dataframe.
A pandas series is a one-dimensional numpy array with an index
which we could use to access the data,
while dataframe consists of a table of values with lables for each row and column.
A dataframe can combine multiple data types, such as numbers and text,
but the data in each column is of the same type.</p>
<img alt="../_images/01_table_dataframe.svg" src="../_images/01_table_dataframe.svg" /><p>Each column of a dataframe is a <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/dsintro.html#series">series object</a> - a dataframe is thus a collection of series.</p>
<p>To load pandas:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<section id="tidy-data-format">
<h3>tidy data format<a class="headerlink" href="#tidy-data-format" title="Permalink to this headline"></a></h3>
<p>Let’s first look at the following two tables:</p>
<div class="admonition-m-running-event exercise important admonition" id="exercise-0">
<p class="admonition-title">1500m Running event</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">untidy data format</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">tidy data format</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-py notranslate"><div class="highlight"><pre><span></span>     <span class="n">Runner</span>  <span class="mi">400</span>  <span class="mi">800</span>  <span class="mi">1200</span>  <span class="mi">1500</span>
<span class="mi">0</span>  <span class="n">Runner</span> <span class="mi">1</span>   <span class="mi">64</span>  <span class="mi">128</span>   <span class="mi">192</span>   <span class="mi">240</span>
<span class="mi">1</span>  <span class="n">Runner</span> <span class="mi">2</span>   <span class="mi">80</span>  <span class="mi">160</span>   <span class="mi">240</span>   <span class="mi">300</span>
<span class="mi">2</span>  <span class="n">Runner</span> <span class="mi">3</span>   <span class="mi">96</span>  <span class="mi">192</span>   <span class="mi">288</span>   <span class="mi">360</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span>      <span class="n">Runner</span> <span class="n">distance</span>  <span class="n">time</span>
<span class="mi">0</span>   <span class="n">Runner</span> <span class="mi">1</span>      <span class="mi">400</span>    <span class="mi">64</span>
<span class="mi">1</span>   <span class="n">Runner</span> <span class="mi">2</span>      <span class="mi">400</span>    <span class="mi">80</span>
<span class="mi">2</span>   <span class="n">Runner</span> <span class="mi">3</span>      <span class="mi">400</span>    <span class="mi">96</span>
<span class="mi">3</span>   <span class="n">Runner</span> <span class="mi">1</span>      <span class="mi">800</span>   <span class="mi">128</span>
<span class="mi">4</span>   <span class="n">Runner</span> <span class="mi">2</span>      <span class="mi">800</span>   <span class="mi">160</span>
<span class="mi">5</span>   <span class="n">Runner</span> <span class="mi">3</span>      <span class="mi">800</span>   <span class="mi">192</span>
<span class="mi">6</span>   <span class="n">Runner</span> <span class="mi">1</span>     <span class="mi">1200</span>   <span class="mi">192</span>
<span class="mi">7</span>   <span class="n">Runner</span> <span class="mi">2</span>     <span class="mi">1200</span>   <span class="mi">240</span>
<span class="mi">8</span>   <span class="n">Runner</span> <span class="mi">3</span>     <span class="mi">1200</span>   <span class="mi">288</span>
<span class="mi">9</span>   <span class="n">Runner</span> <span class="mi">1</span>     <span class="mi">1500</span>   <span class="mi">240</span>
<span class="mi">10</span>  <span class="n">Runner</span> <span class="mi">2</span>     <span class="mi">1500</span>   <span class="mi">300</span>
<span class="mi">11</span>  <span class="n">Runner</span> <span class="mi">3</span>     <span class="mi">1500</span>   <span class="mi">360</span>
</pre></div>
</div>
</div></div>
</div>
<p>Most tabular data is either in a tidy format or a untidy format (some people refer them as the long format or the wide format).</p>
<p>In short, in an untidy (wide) format, each row represents an observation
consisting of multiple variables and each variable has its own column.
This is very intuitive and easy for us (human beings) to understand
and  make comparisons across different variables, calculate statistics, etc.
In a tidy (long) format , i.e. column-oriented format, each row represents
only one variable of the observation, and can be considered “computer readable”.</p>
<p>Both formats have their own merits and you need to know which one suits your analysis.
For example, if you are dealing with matrices, you would not want to store them as rows and columns,
but as a two-dimensional array using untidy format. On the other hand, if you need to add new data
or remove old data frequently from the table in a relational database, the tidy format may be the choice.
Another case is that there are certain visualization tools which take data in the tidy format, e,g, ggplot, seaborn.</p>
<p>When it comes to data analysis using pandas, the tidy format is recommended:
- each column can be stored as a vector and this not only saves memory
but also allows for vectorized calculations which are much faster.
- it’s easier to filter, group, join and aggregate the data</p>
<p>The name “tidy data” comes from Wickham’s paper (2014) which describes the ideas in great detail.</p>
</section>
</section>
<section id="data-pre-processing">
<h2>data pre-processing<a class="headerlink" href="#data-pre-processing" title="Permalink to this headline"></a></h2>
<p>In real applications, some data pre-processing have to be performed before one can perform useful analysis.
There is no fixed list of what these pre-processings are, but in general the following steps are involved:</p>
<ul class="simple">
<li><p>data cleaning</p></li>
<li><p>data reshaping</p></li>
<li><p>data</p></li>
</ul>
<section id="data-cleaning">
<h3>data cleaning<a class="headerlink" href="#data-cleaning" title="Permalink to this headline"></a></h3>
<p>A couple of essential  data cleaning processes include but not limited to the following:</p>
<ul class="simple">
<li><p>data renaming</p></li>
<li><p>data reordering</p></li>
<li><p>data type converting</p></li>
<li><p>handling of duplicating data, missing data, invalid data</p></li>
</ul>
<p>add examples
<a class="reference external" href="https://pandas.pydata.org/docs/user_guide/missing_data.html">https://pandas.pydata.org/docs/user_guide/missing_data.html</a></p>
</section>
<section id="data-reshaping">
<h3>data Reshaping<a class="headerlink" href="#data-reshaping" title="Permalink to this headline"></a></h3>
<p>Once data cleaning is done, we will reach the data reshaping phase. By reorganising the data, one could make the subsequent data operations easier.</p>
<section id="pivoting">
<h4>pivoting<a class="headerlink" href="#pivoting" title="Permalink to this headline"></a></h4>
<p>Create a data frame first</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="p">{</span>
 <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">]</span> <span class="p">,</span>
 <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
 <span class="s2">&quot;zoo&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="s2">&quot;q&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To select out everything for variable <code class="docutils literal notranslate"><span class="pre">A</span></code> we could do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">]</span>
<span class="n">filtered</span>
</pre></div>
</div>
<p>But suppose we would like to represent the table in such a way that
the <code class="docutils literal notranslate"><span class="pre">columns</span></code> are the unique variables from ‘bar’ and the <code class="docutils literal notranslate"><span class="pre">index</span></code> from ‘foo’.
To reshape the data into this form, we use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.pivot()</span></code> method (also implemented as a
top level function <code class="xref py py-func docutils literal notranslate"><span class="pre">pivot()</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pivoted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">)</span>
<span class="n">pivoted</span>
</pre></div>
</div>
<img alt="../_images/reshaping_pivot.png" src="../_images/reshaping_pivot.png" />
<p>If the <code class="docutils literal notranslate"><span class="pre">values</span></code> argument is omitted, and the input <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> has more than
one column of values which are not used as column or index inputs to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pivot()</span></code>,
then the resulting “pivoted” <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> will have <span class="xref std std-ref">hierarchical columns</span> whose topmost level indicates the respective value
column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;value2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">pivoted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
<span class="n">pivoted</span>
</pre></div>
</div>
<p>You can then select subsets from the pivoted <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pivoted</span><span class="p">[</span><span class="s2">&quot;value2&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that this returns a view on the underlying data in the case where the data
are homogeneously-typed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">pivot()</span></code> will error with a <code class="docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">Index</span> <span class="pre">contains</span> <span class="pre">duplicate</span>
<span class="pre">entries,</span> <span class="pre">cannot</span> <span class="pre">reshape</span></code> if the index/column pair is not unique. In this
case, consider using <code class="xref py py-func docutils literal notranslate"><span class="pre">pivot_table()</span></code> which is a generalization
of pivot that can handle duplicate values for one index/column pair.</p>
</div>
</section>
<section id="stacking-and-unstacking">
<h4>stacking and unstacking<a class="headerlink" href="#stacking-and-unstacking" title="Permalink to this headline"></a></h4>
<p>Closely related to the pivot() method are the related stack() and unstack() methods available on Series and DataFrame.
These methods are designed to work together with MultiIndex objects.</p>
<p>The stack() function “compresses” a level in the DataFrame columns to produce either:
- A Series, in the case of a simple column Index.
- A DataFrame, in the case of a MultiIndex in the columns.</p>
<p>If the columns have a MultiIndex, you can choose which level to stack. The stacked level becomes the new lowest level in a MultiIndex on the columns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tuples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<span class="nb">zip</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;qux&quot;</span><span class="p">,</span> <span class="s2">&quot;qux&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">],</span>
        <span class="p">]</span>
<span class="p">)</span>
<span class="p">)</span>

<span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
<span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;qux&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;qux&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">tuples</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Note: there are other ways to generate MultiIndex, e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">(</span>
<span class="p">[(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;qux&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">)],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="n">df</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">df2</span>
<span class="n">stacked</span><span class="o">=</span><span class="n">df2</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/reshaping_stack.png" src="../_images/reshaping_stack.png" />
<p>The unstack() method performs the inverse operation of stack(), and by default unstacks the last level.
If the indexes have names, you can use the level names instead of specifying the level numbers.</p>
<p>stacked.unstack()</p>
<img alt="../_images/reshaping_unstack.png" src="../_images/reshaping_unstack.png" />
<p>stacked.unstack(1)
or
stacked.unstack(“second”)</p>
<img alt="../_images/reshaping_unstack_1.png" src="../_images/reshaping_unstack_1.png" />
<img alt="../_images/reshaping_unstack_0.png" src="../_images/reshaping_unstack_0.png" />
</section>
</section>
</section>
<section id="groupby">
<h2>groupby<a class="headerlink" href="#groupby" title="Permalink to this headline"></a></h2>
<p>As we know, when it is about  mathematical oprations on arrays of numerical data, Numpy does best.
Pandas works very well with numpy when aggregating dataframes.</p>
<p>Pandas has a strong built-in understanding of time. With datasets indexed by a pandas DateTimeIndex,
we can easily group and resample the data using common time units.</p>
<p>The groupby() method is an amazingly powerful function in pandas. But it is also complicated to use and understand.
Together with pivot() / stack() / unstack() and the basic Series and DataFrame statistical functions,
groupby can produce some very expressive and fast data manipulations.</p>
<img alt="../_images/groupby.png" src="../_images/groupby.png" />
<p>The workflow of groubpy method can be divided into three general steps:</p>
<ul class="simple">
<li><p>Splitting: Partition the data into different groups based on some criterion.</p></li>
<li><p>Applying: Do some caclulation within each group. Different kinds of calulations might be aggregation, transformation, filtration</p></li>
<li><p>Combining: Put the results back together into a single object.</p></li>
</ul>
<section id="data-aggregation">
<h3>data aggregation<a class="headerlink" href="#data-aggregation" title="Permalink to this headline"></a></h3>
<p>Here we will go through the following example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">header_url</span> <span class="o">=</span> <span class="s1">&#39;ftp://ftp.ncdc.noaa.gov/pub/data/uscrn/products/daily01/HEADERS.txt&#39;</span>
<span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">header_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

<span class="n">ftp_base</span> <span class="o">=</span> <span class="s1">&#39;ftp://ftp.ncdc.noaa.gov/pub/data/uscrn/products/daily01/&#39;</span>
<span class="n">dframes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">2019</span><span class="p">):</span>
    <span class="n">data_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">/CRND0103-</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">-NY_Millbrook_3_W.txt&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ftp_base</span> <span class="o">+</span> <span class="n">data_url</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                     <span class="n">names</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span>
                     <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">9999.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">99.0</span><span class="p">])</span>
    <span class="n">dframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dframes</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;LST_DATE&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">]</span> <span class="c1"># or df.T_DAILY_MEAN</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span>   <span class="c1"># df.index is a pandas DateTimeIndex object.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gbyear</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">gbyear</span><span class="o">.</span><span class="n">T_DAILY_MEAN</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">gbyear</span><span class="o">.</span><span class="n">T_DAILY_MEAN</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">gbyear</span><span class="o">.</span><span class="n">T_DAILY_MEAN</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
<span class="n">gbyear</span><span class="o">.</span><span class="n">T_DAILY_MEAN</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
</pre></div>
</div>
<p>now let us calculate the monthly mean values</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">)</span>  <span class="c1"># or  df.groupby(df.T_DAILY_MEAN)</span>
<span class="n">monthly_climatology</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">monthly_climatology</span>
</pre></div>
</div>
<p>Each row in this new dataframe respresents the average values for the months (1=January, 2=February, etc.)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_T_climatology</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">({</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                                                      <span class="s1">&#39;T_DAILY_MAX&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
                                                      <span class="s1">&#39;T_DAILY_MIN&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">})</span>
<span class="n">monthly_T_climatology</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">daily_T_climatology</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofyear</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">({</span><span class="s1">&#39;T_DAILY_MEAN&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;T_DAILY_MAX&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;T_DAILY_MIN&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">anomaly</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">standardize</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="data-transfromation">
<h3>data transfromation<a class="headerlink" href="#data-transfromation" title="Permalink to this headline"></a></h3>
<p>The key difference between aggregation and transformation is that
aggregation returns a smaller object than the original,
indexed by the group keys, while transformation returns an object
with the same index (and same size) as the original object.</p>
<p>In this example, we standardize the temperature so that
the distribution has zero mean and unit variance.
We do this by first defining a function called standardize
and then passing it to the transform method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformed</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">grouped_trans</span> <span class="o">=</span> <span class="n">transformed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-getting-help callout admonition" id="callout-0">
<p class="admonition-title">Getting help</p>
<p>Series and DataFrames have a lot functionality, but
how can we find out what methods are available and how they work? One way is to visit
the <a class="reference external" href="https://pandas.pydata.org/docs/reference/frame.html">API reference</a>
and reading through the list.
Another way is to use the autocompletion feature in Jupyter and type e.g.
<code class="docutils literal notranslate"><span class="pre">titanic[&quot;Age&quot;].</span></code> in a notebook and then hit <code class="docutils literal notranslate"><span class="pre">TAB</span></code> twice - this should open
up a list menu of available methods and attributes.</p>
<p>Jupyter also offers quick access to help pages (docstrings) which can be
more efficient than searching the internet. Two ways exist:</p>
<ul class="simple">
<li><p>Write a function name followed by question mark and execute the cell, e.g.
write <code class="docutils literal notranslate"><span class="pre">titanic.hist?</span></code> and hit <code class="docutils literal notranslate"><span class="pre">SHIFT</span> <span class="pre">+</span> <span class="pre">ENTER</span></code>.</p></li>
<li><p>Write the function name and hit <code class="docutils literal notranslate"><span class="pre">SHIFT</span> <span class="pre">+</span> <span class="pre">TAB</span></code>.</p></li>
</ul>
</div>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>pandas dataframes are a good data structure for tabular data</p></li>
<li><p>Dataframes allow both simple and advanced analysis in very compact form</p></li>
</ul>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../numpy/" class="btn btn-neutral float-left" title="NumPy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../scipy/" class="btn btn-neutral float-right" title="SciPy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>